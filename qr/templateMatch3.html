<!DOCTYPE html>
<html>
<head><meta charset="utf-8">
<title>Template Matching</title>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/opencv.js/5..1/opencv.min.js"></script>
<script src="https://docs.opencv.org/master/opencv.js"></script>-->
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/v8b253dfea2ab4077af8c6f58422dfbfd1689876627854" integrity="sha512-bjgnUKX4azu3dLTVtie9u6TKqgx29RBwfj3QXYt5EKfWM/9hPSAI/4qcV5NACjwAo8UtTeWefx6Zq5PHcMm7Tg==" data-cf-beacon='{"rayId":"7fe976fc9b5713dc","version":"2023.8.0","r":1,"token":"55698296dd8c4381b9a17117972ffe0c","si":100}' crossorigin="anonymous"></script>

<!--<script src="opencv.js" type="text/javascript"></script>-->


<style>
body {
  margin: 0;
  padding: 0;
}

.container {
  width: 500px;
  margin: 0 auto;
}

.input-image {
  width: 100%;
}

.template-image {
  width: 100%;
}

.results {
  margin-top: 20px;
}
</style>
</head>
<body>
<div class="container">
  <h1>Template Matching</h1>

  <div class="input-image">
    <label for="input-file">Input Image:</label>
    <input type="file" id="input-file" accept="image/*">
    <img id="input-image" />
  </div>

  <div class="template-image">
    <label for="template-file">Template Image:</label>
    <input type="file" id="template-file" accept="image/*">
    <img id="template-image" />
  </div>

  <div class="results">
    <p>The results will be displayed here.</p>
  </div>

  <button id="submit">Submit</button>
</div>

<script>
var inputImage = document.getElementById("input-image");
var templateImage = document.getElementById("template-image");
var results = document.getElementById("results");

var inputFile = document.getElementById("input-file");
var templateFile = document.getElementById("template-file");

var submitButton = document.getElementById("submit");

inputFile.onchange = function() {
  var file = inputFile.files[0];
  var reader = new FileReader();
  
  reader.onload = function() {
    inputImage.src = reader.result;
  };
  
  reader.readAsDataURL(file);
};

templateFile.onchange = function() {
  var file = templateFile.files[0];
  var reader = new FileReader();
  
  reader.onload = function() {
    templateImage.src = reader.result;
  };
  
  reader.readAsDataURL(file);
};

submitButton.onclick = function() {
  // Get the input image and template image data.
  var inputImageData = inputImage.src;
  var templateImageData = templateImage.src;

  // Load the images using OpenCV.js.
  cv.imreadAsync(inputImageData, function(inputMat) {
    cv.imreadAsync(templateImageData, function(templateMat) {

      // Apply template matching using OpenCV.js.
      var matches = new cv.Mat();
      cv.matchTemplate(inputMat, templateMat, matches, cv.TM_CCOEFF_NORMED);

      // Find the location of the best match.
      var minMaxLocResult = new cv.minMaxLoc(matches);
      var maxLoc = minMaxLocResult.maxLoc;

      // Draw a rectangle around the matched region.
      var matchWidth = templateMat.cols;
      var matchHeight = templateMat.rows;
      var topLeftPoint = new cv.Point(maxLoc.x, maxLoc.y);
      var bottomRightPoint = new cv.Point(maxLoc.x + matchWidth, maxLoc.y + matchHeight);
      cv.rectangle(inputMat, topLeftPoint, bottomRightPoint, [255,0,0,255],2);

      // Display the results.
      cv.imshow('results', inputMat);
      
      // Free memory.
      inputMat.delete();
      templateMat.delete();
      matches.delete();
    });
  });
};
</script>
</body>
</html>